"use strict";const i=require("path"),{app:o,BrowserWindow:t}=require("electron"),{creatProtocol:l}=require("./module/protocol"),{createLoginWindow:s}=require("./module/loginWin"),c=require("electron-window-state"),w=require("./handler"),n=require("electron-is-dev"),{createTray:d,createTrayWindow:g}=require("./module/tray"),{setThumbarButton:u}=require("./module/thumbarButtons");l();n||(global.__img=i.join(__dirname,"./img"),global.__images=i.join(__dirname,"./images"));const f=n?"public/images/tray.ico":`${global.__images}/tray.ico`;process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";function a(){let e=c({defaultWidth:1200,defaultHeight:800});global.win=new t({show:!1,center:!0,minWidth:e.width,minHeight:e.height,resizable:!0,alwaysOnTop:!1,icon:f,titleBarStyle:"hiddenInset",frame:process.platform!=="win32",backgroundColor:"#fff",hasShadow:!0,webPreferences:{webSecurity:!0,nodeIntegration:!0,contextIsolation:!0,preload:i.join(__dirname,"preload.js")}}),global.win.once("ready-to-show",()=>{global.win.show(),process.platform==="win32"&&(u(!1),global.tray=d(),global.trayWindow=g(),global.loginWindow=s())}),process.platform,n?(global.win.loadURL("http://localhost:3100/jingluo"),global.win.webContents.openDevTools(),require("electron-reload")(__dirname,{electron:require("../node_modules/electron")})):global.win.loadFile(i.join(__dirname,"../index.html")),global.win.on("close",r=>{if(r.preventDefault(),process.platform!=="darwin")return global.win.hide()}),global.win.on("closed",r=>{})}o.whenReady().then(()=>{w(),a()});o.on("second-instance",()=>{const e=BrowserWindowsMap.get(global.win.id);e&&(e.restore(),e.show())});o.on("activate",()=>{if(!t.getAllWindows().length)return a()});o.on("window-all-closed",()=>{if(process.platform!=="darwin")return o.quit()});
