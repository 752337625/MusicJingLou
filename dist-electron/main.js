"use strict";const i=require("path"),{app:o,BrowserWindow:t,screen:c}=require("electron"),{creatProtocol:w}=require("./module/protocol"),{createLoginWindow:d}=require("./module/loginWin"),{createTray:g,createTrayWindow:u}=require("./module/trayWin"),{createLyricWindow:b}=require("./module/desktopLyricWin"),{setThumbarButton:f}=require("./module/thumbarButtons"),n=require("electron-is-dev"),p=require("./handler");w();n||(global.__img=i.join(__dirname,"./img"),global.__images=i.join(__dirname,"./images"));const h=n?"public/images/tray.ico":`${global.__images}/tray.ico`;process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";function a(){let{size:e}=c.getPrimaryDisplay(),l=(e.width-1660)/2,s=(e.height-800)/2;global.win=new t({x:l,y:s,show:!1,center:!0,minWidth:1660,minHeight:800,resizable:!0,alwaysOnTop:!1,icon:h,titleBarStyle:"hiddenInset",frame:process.platform!=="win32",backgroundColor:"#fff",hasShadow:!0,skipTaskbar:!1,webPreferences:{webSecurity:!0,nodeIntegration:!0,contextIsolation:!0,preload:i.join(__dirname,"preload.js")}}),global.win.hookWindowMessage(278,()=>(global.win.setEnabled(!1),setTimeout(()=>{global.win.setEnabled(!0)},100),!0)),global.win.once("ready-to-show",()=>{global.win.show(),process.platform==="win32"&&(f(!1),global.tray=g(),global.trayWindow=u(),global.loginWindow=d(),global.lyricWindow=b())}),process.platform,n?(global.win.loadURL("http://localhost:3100/jingluo"),global.win.webContents.openDevTools()):global.win.loadFile(i.join(__dirname,"../index.html")),global.win.on("close",r=>{if(r.preventDefault(),process.platform!=="darwin")return global.win.hide()}),global.win.on("closed",r=>{})}o.whenReady().then(()=>{p(),a()});o.on("second-instance",()=>{const e=BrowserWindowsMap.get(global.win.id);e&&(e.restore(),e.show())});o.on("activate",()=>{if(!t.getAllWindows().length)return a()});o.on("window-all-closed",()=>{if(process.platform!=="darwin")return o.quit()});
