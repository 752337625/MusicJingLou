"use strict";const i=require("path"),{app:o,BrowserWindow:t,screen:c}=require("electron"),{creatProtocol:w}=require("./module/protocol"),{createLoginWindow:d}=require("./module/loginWin"),g=require("./handler"),n=require("electron-is-dev"),{createTray:u,createTrayWindow:p}=require("./module/tray"),{setThumbarButton:b}=require("./module/thumbarButtons");w();n||(global.__img=i.join(__dirname,"./img"),global.__images=i.join(__dirname,"./images"));const f=n?"public/images/tray.ico":`${global.__images}/tray.ico`;process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";function a(){let{size:e}=c.getPrimaryDisplay(),l=(e.width-1660)/2,s=(e.height-800)/2;global.win=new t({x:l,y:s,show:!1,center:!0,minWidth:1660,minHeight:800,resizable:!0,alwaysOnTop:!1,icon:f,titleBarStyle:"hiddenInset",frame:process.platform!=="win32",backgroundColor:"#fff",hasShadow:!0,skipTaskbar:!1,webPreferences:{webSecurity:!0,nodeIntegration:!0,contextIsolation:!0,preload:i.join(__dirname,"preload.js")}}),global.win.once("ready-to-show",()=>{global.win.show(),process.platform==="win32"&&(b(!1),global.tray=u(),global.trayWindow=p(),global.loginWindow=d())}),process.platform,n?(global.win.loadURL("http://localhost:3100/jingluo"),global.win.webContents.openDevTools(),require("electron-reload")(__dirname,{electron:require("../node_modules/electron")})):global.win.loadFile(i.join(__dirname,"../index.html")),global.win.on("close",r=>{if(r.preventDefault(),process.platform!=="darwin")return global.win.hide()}),global.win.on("closed",r=>{})}o.whenReady().then(()=>{g(),a()});o.on("second-instance",()=>{const e=BrowserWindowsMap.get(global.win.id);e&&(e.restore(),e.show())});o.on("activate",()=>{if(!t.getAllWindows().length)return a()});o.on("window-all-closed",()=>{if(process.platform!=="darwin")return o.quit()});
