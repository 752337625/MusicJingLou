"use strict";const n=require("path"),{app:o,BrowserWindow:r}=require("electron"),{creatProtocol:t}=require("./module/protocol"),l=require("./handler"),i=require("electron-is-dev"),{createTray:s,createTrayWindow:c}=require("./module/tray"),{setThumbarButton:w}=require("./module/thumbarButtons");t();i||(global.__img=n.join(__dirname,"./img"),global.__images=n.join(__dirname,"./images"));const d=i?"public/images/tray.ico":`${global.__images}/tray.ico`;process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";function a(){global.win=new r({show:!1,minWidth:1500,minHeight:900,resizable:!0,alwaysOnTop:!1,icon:d,titleBarStyle:"hiddenInset",frame:process.platform!=="win32",backgroundColor:"#fff",hasShadow:!0,webPreferences:{devTools:i,webSecurity:!0,nodeIntegration:!0,contextIsolation:!0,preload:n.join(__dirname,"preload.js")}}),global.win.once("ready-to-show",()=>{global.win.show(),process.platform==="win32"&&(w(!1),global.tray=s(),global.trayWindow=c())}),process.platform,i?(global.win.loadURL("http://localhost:3100/jingluo"),global.win.webContents.openDevTools(),require("electron-reload")(__dirname,{electron:require("../node_modules/electron")})):global.win.loadFile(n.join(__dirname,"../index.html")),global.win.on("close",e=>{if(e.preventDefault(),process.platform!=="darwin")return global.win.hide()}),global.win.on("closed",e=>{})}o.whenReady().then(()=>{l(),a()});o.on("second-instance",()=>{const e=BrowserWindowsMap.get(global.win.id);e&&(e.restore(),e.show())});o.on("activate",()=>{if(!r.getAllWindows().length)return a()});o.on("window-all-closed",()=>{if(process.platform!=="darwin")return o.quit()});
